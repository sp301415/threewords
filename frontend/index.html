<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex">

    <title>세 단어로 나눠요</title>

    <meta property="og:title" content="세 단어로 나눠요" />
    <meta name="author" content="sp301415" />
    <meta property="og:locale" content="ko_KR" />
    <meta name="description" content="세 단어 파일 공유 서비스" />
    <meta property="og:description" content="세 단어 파일 공유 서비스" />
    <link rel="canonical" href="https://threewords.sp301415.com" />
    <meta property="og:url" content="https://threewords.sp301415.com" />
    <meta property="og:site_name" content="세 단어로 나눠요" />
    <meta property="og:image" content="https://threewords.sp301415.com/cover.jpg" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:image" content="https://threewords.sp301415.com/cover.jpg" />
    <meta property="twitter:title" content="세 단어로 나눠요" />

    <link rel="stylesheet" href="css/pico.min.css">
    <style>
        :root {
            --grid-spacing-horizontal: 5rem;
        }

        hr {
            margin: var(--spacing) 0;
        }

    </style>
    <script>
        function upload() {
            let button = document.getElementById("upload_button");
            let file_input = document.getElementById("upload");
            let file = file_input.files[0];
            let formData = new FormData();

            if (file.size >= 100 * (1 << 20)) {
                alert("파일 사이즈가 너무 큽니다! 100MB까지 업로드할 수 있습니다.");
                return;
            }

            button.ariaBusy = "true";
            file_input.disabled = true;
            formData.append("upload", file);
            fetch('https://threewords-api.sp301415.com/upload', { method: "POST", body: formData })
                .then(response => {
                    if (response.ok) {
                        response.text().then(text => {
                            document.getElementById("upload_words").innerText = text;
                        }).catch(console.log);
                    } else {
                        response.text.then(alert).catch(console.log);;
                    }
                })
                .catch(console.log)
                .finally(_ => {
                    button.ariaBusy = "false";
                    file_input.disabled = false;
                });
        }

        function download() {
            let button = document.getElementById("download_button")

            let word0 = document.getElementById("word0").value;
            let word1 = document.getElementById("word1").value;
            let word2 = document.getElementById("word2").value;
            let formData = new FormData();

            button.ariaBusy = "true";
            formData.append("word0", word0)
            formData.append("word1", word1)
            formData.append("word2", word2)
            fetch("https://threewords-api.sp301415.com/download", { method: "POST", body: formData })
                .then(response => {
                    if (response.ok) {
                        response.formData()
                            .then(data => data.get("file"))
                            .then(file => {
                                const url = URL.createObjectURL(file);
                                const link = document.getElementById("download_link")

                                link.href = url;
                                link.download = decodeURIComponent(escape(atob(file.name)));
                                link.click();
                                URL.revokeObjectURL(url);
                            }).catch(console.log);
                    } else {
                        response.text().then(alert).catch(console.log);
                    }
                })
                .catch(console.log)
                .finally(_ => {
                    button.ariaBusy = "false";
                });

            return false;
        }

        function parse_threewords(event) {
            let words = (event.clipboardData || window.clipboardData).getData('text').split(",");
            if (words.length != 3) {
                return;
            }

            event.preventDefault()
            document.getElementById("word0").value = words[0].trim();
            document.getElementById("word1").value = words[1].trim();
            document.getElementById("word2").value = words[2].trim();
        }
    </script>
</head>

<body>
    <main class="container">
        <article>
            <hgroup>
                <h1>세 단어로...</h1>
                <h2 style="color: red;">주의!! 아직 정식 오픈 전입니다. 파일이 갑자기 삭제되거나 작동하지 않을 수 있습니다.</h2>
            </hgroup>
            <div class="grid">
                <div>
                    <h2>보내요</h2>
                    <input type="file" id="upload" name="upload">
                    <button onclick="upload()" id="upload_button">보내기</button>
                    <small>* 파일은 24시간 뒤 삭제됩니다.</small>
                    <hr>
                    <div>
                        이 파일의 키는...
                        <h1 id="upload_words"></h1>
                    </div>
                </div>
                <div>
                    <h2>받아요</h2>
                    <form target="_self" onsubmit="return download()" method="post">
                        <input type="text" id="word0" onpaste="parse_threewords(event)" placeholder="첫번째 단어" required>
                        <input type="text" id="word1" onpaste="parse_threewords(event)" placeholder="두번째 단어" required>
                        <input type="text" id="word2" onpaste="parse_threewords(event)" placeholder="세번째 단어" required>
                        <button id="download_button">받기</button>
                    </form>
                    <a id="download_link" , style="display: none;">제가 보이면 클릭해 보세요 ㅇㅅㅇ</a>
                </div>
        </article>
    </main>
</body>

</html>
